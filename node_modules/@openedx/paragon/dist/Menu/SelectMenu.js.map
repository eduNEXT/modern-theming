{"version":3,"file":"SelectMenu.js","names":["React","useState","useEffect","useCallback","PropTypes","classNames","ExpandMore","Button","ModalPopup","useToggle","Menu","withDeprecatedProps","DeprTypes","SELECT_MENU_DEFAULT_MESSAGE","SelectMenu","_ref","defaultMessage","children","className","variant","disabled","props","triggerTarget","setTriggerTarget","focusMenuRef","useRef","itemsCollection","useMemo","Array","from","length","map","createRef","defaultIndex","i","defaultSelected","undefined","selected","setSelected","isOpen","open","close","createMenuItems","Children","child","index","newProps","onClick","e","current","id","toString","role","cloneElement","prevOpenRef","numItems","scrollIntoView","block","focus","preventScroll","createElement","ref","iconAfter","placement","positionRef","onClose","modifiers","name","options","padding","top","bottom","key","propTypes","string","node","isRequired","bool","defaultProps","SelectMenuWithDeprecatedProp","isLink","deprType","MOVED_AND_FORMAT","message","newName","transform"],"sources":["../../src/Menu/SelectMenu.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { ExpandMore } from '../../icons';\nimport Button from '../Button';\nimport ModalPopup from '../Modal/ModalPopup';\nimport useToggle from '../hooks/useToggleHook';\nimport Menu from '.';\nimport withDeprecatedProps, { DeprTypes } from '../withDeprecatedProps';\n\nexport const SELECT_MENU_DEFAULT_MESSAGE = 'Select...';\n\nfunction SelectMenu({\n  defaultMessage,\n  children,\n  className,\n  variant,\n  disabled,\n  ...props\n}) {\n  const [triggerTarget, setTriggerTarget] = useState(null);\n  // this ref is used to focus the menu open button after any menu option is clicked.\n  // triggerTarget.current.focus() inside the onCLick() function didn't guarantee element focus.\n  const focusMenuRef = React.useRef(false);\n  const itemsCollection = React.useMemo(\n    () => Array.from({ length: children.length }).map(() => React.createRef()),\n    [children.length],\n  );\n\n  const defaultIndex = useCallback(() => {\n    for (let i = 0; i < children.length; i++) {\n      if (children[i].props && children[i].props.defaultSelected) {\n        return i;\n      }\n    }\n    return undefined;\n  }, [children]);\n\n  const [selected, setSelected] = useState(defaultIndex());\n  const [isOpen, open, close] = useToggle(false);\n\n  const createMenuItems = () => React.Children.map(children, (child, index) => {\n    const newProps = {\n      onClick(e) {\n        if (child.props.onClick) {\n          child.props.onClick(e);\n        }\n        setSelected(index);\n        close();\n        focusMenuRef.current = true;\n      },\n      id: `${index.toString()}_pgn__menu-item`,\n      role: 'link',\n    };\n    if (selected === index) {\n      newProps['aria-current'] = 'page';\n    }\n    return React.cloneElement(child, newProps);\n  });\n\n  const prevOpenRef = React.useRef();\n\n  useEffect(() => {\n    if (isOpen && selected) {\n      const numItems = children.length;\n      if (numItems > 6 && selected > 1 && numItems - selected > 2) {\n        // on \"middle elements\", set offset to center of block and scroll to center\n        itemsCollection[selected].current.children[0].scrollIntoView({\n          block: 'center',\n        });\n      }\n    }\n    // set focus on open\n    if (isOpen && !prevOpenRef.current && selected) {\n      itemsCollection[selected].current.children[0].focus({ preventScroll: (defaultIndex() === selected) });\n    }\n    if (focusMenuRef.current) {\n      triggerTarget.focus();\n      focusMenuRef.current = false;\n    }\n    prevOpenRef.current = isOpen;\n  }, [isOpen, children.length, defaultIndex, itemsCollection, selected, triggerTarget]);\n\n  return (\n    <div className={classNames('pgn__menu-select', className)} {...props}>\n      <Button\n        aria-haspopup=\"true\"\n        aria-expanded={isOpen}\n        ref={setTriggerTarget}\n        variant={variant}\n        iconAfter={ExpandMore}\n        onClick={open}\n        disabled={disabled}\n      >\n        {selected !== undefined && children[selected] ? children[selected].props.children : defaultMessage}\n      </Button>\n      <div className=\"pgn__menu-select-popup\">\n        <ModalPopup\n          placement=\"bottom-start\"\n          positionRef={triggerTarget}\n          isOpen={isOpen}\n          onClose={close}\n          modifiers={\n            [\n              {\n                name: 'flip',\n                options: {\n                  padding: { top: 150, bottom: 150 },\n                },\n              },\n            ]\n          }\n        >\n          <Menu aria-label=\"Select Menu\">\n            {createMenuItems().map((child, index) => (\n              <div key={child.props.id} ref={itemsCollection[index]}>\n                {child}\n              </div>\n            ))}\n          </Menu>\n        </ModalPopup>\n      </div>\n    </div>\n  );\n}\n\nSelectMenu.propTypes = {\n  /** String that is displayed for default value of the ``SelectMenu`` */\n  defaultMessage: PropTypes.string,\n  /** Specifies the content of the ``SelectMenu`` */\n  children: PropTypes.node.isRequired,\n  /** Specifies class name to append to the base element */\n  className: PropTypes.string,\n  /** Specifies variant to use. */\n  variant: PropTypes.string,\n  /** Specifies if the `SelectMenu` is disabled. */\n  disabled: PropTypes.bool,\n};\n\nSelectMenu.defaultProps = {\n  defaultMessage: SELECT_MENU_DEFAULT_MESSAGE,\n  className: undefined,\n  variant: 'outline-primary',\n  disabled: false,\n};\n\nconst SelectMenuWithDeprecatedProp = withDeprecatedProps(SelectMenu, 'SelectMenu', {\n  isLink: {\n    deprType: DeprTypes.MOVED_AND_FORMAT,\n    message: 'Use \"variant\" prop instead, i.e. variant=\"link\"',\n    newName: 'variant',\n    transform: () => 'link',\n  },\n});\n\nexport default SelectMenuWithDeprecatedProp;\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAC/D,OAAOC,SAAS,MAAM,YAAY;AAClC,OAAOC,UAAU,MAAM,YAAY;AACnC,SAASC,UAAU,QAAQ,aAAa;AACxC,OAAOC,MAAM,MAAM,WAAW;AAC9B,OAAOC,UAAU,MAAM,qBAAqB;AAC5C,OAAOC,SAAS,MAAM,wBAAwB;AAC9C,OAAOC,IAAI,MAAM,GAAG;AACpB,OAAOC,mBAAmB,IAAIC,SAAS,QAAQ,wBAAwB;AAEvE,OAAO,MAAMC,2BAA2B,GAAG,WAAW;AAEtD,SAASC,UAAUA,CAAAC,IAAA,EAOhB;EAAA,IAPiB;IAClBC,cAAc;IACdC,QAAQ;IACRC,SAAS;IACTC,OAAO;IACPC,QAAQ;IACR,GAAGC;EACL,CAAC,GAAAN,IAAA;EACC,MAAM,CAACO,aAAa,EAAEC,gBAAgB,CAAC,GAAGtB,QAAQ,CAAC,IAAI,CAAC;EACxD;EACA;EACA,MAAMuB,YAAY,GAAGxB,KAAK,CAACyB,MAAM,CAAC,KAAK,CAAC;EACxC,MAAMC,eAAe,GAAG1B,KAAK,CAAC2B,OAAO,CACnC,MAAMC,KAAK,CAACC,IAAI,CAAC;IAAEC,MAAM,EAAEb,QAAQ,CAACa;EAAO,CAAC,CAAC,CAACC,GAAG,CAAC,mBAAM/B,KAAK,CAACgC,SAAS,CAAC,CAAC,CAAC,EAC1E,CAACf,QAAQ,CAACa,MAAM,CAClB,CAAC;EAED,MAAMG,YAAY,GAAG9B,WAAW,CAAC,MAAM;IACrC,KAAK,IAAI+B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjB,QAAQ,CAACa,MAAM,EAAEI,CAAC,EAAE,EAAE;MACxC,IAAIjB,QAAQ,CAACiB,CAAC,CAAC,CAACb,KAAK,IAAIJ,QAAQ,CAACiB,CAAC,CAAC,CAACb,KAAK,CAACc,eAAe,EAAE;QAC1D,OAAOD,CAAC;MACV;IACF;IACA,OAAOE,SAAS;EAClB,CAAC,EAAE,CAACnB,QAAQ,CAAC,CAAC;EAEd,MAAM,CAACoB,QAAQ,EAAEC,WAAW,CAAC,GAAGrC,QAAQ,CAACgC,YAAY,CAAC,CAAC,CAAC;EACxD,MAAM,CAACM,MAAM,EAAEC,IAAI,EAAEC,KAAK,CAAC,GAAGhC,SAAS,CAAC,KAAK,CAAC;EAE9C,MAAMiC,eAAe,GAAGA,CAAA,KAAM1C,KAAK,CAAC2C,QAAQ,CAACZ,GAAG,CAACd,QAAQ,EAAE,CAAC2B,KAAK,EAAEC,KAAK,KAAK;IAC3E,MAAMC,QAAQ,GAAG;MACfC,OAAOA,CAACC,CAAC,EAAE;QACT,IAAIJ,KAAK,CAACvB,KAAK,CAAC0B,OAAO,EAAE;UACvBH,KAAK,CAACvB,KAAK,CAAC0B,OAAO,CAACC,CAAC,CAAC;QACxB;QACAV,WAAW,CAACO,KAAK,CAAC;QAClBJ,KAAK,CAAC,CAAC;QACPjB,YAAY,CAACyB,OAAO,GAAG,IAAI;MAC7B,CAAC;MACDC,EAAE,EAAE,GAAGL,KAAK,CAACM,QAAQ,CAAC,CAAC,iBAAiB;MACxCC,IAAI,EAAE;IACR,CAAC;IACD,IAAIf,QAAQ,KAAKQ,KAAK,EAAE;MACtBC,QAAQ,CAAC,cAAc,CAAC,GAAG,MAAM;IACnC;IACA,oBAAO9C,KAAK,CAACqD,YAAY,CAACT,KAAK,EAAEE,QAAQ,CAAC;EAC5C,CAAC,CAAC;EAEF,MAAMQ,WAAW,GAAGtD,KAAK,CAACyB,MAAM,CAAC,CAAC;EAElCvB,SAAS,CAAC,MAAM;IACd,IAAIqC,MAAM,IAAIF,QAAQ,EAAE;MACtB,MAAMkB,QAAQ,GAAGtC,QAAQ,CAACa,MAAM;MAChC,IAAIyB,QAAQ,GAAG,CAAC,IAAIlB,QAAQ,GAAG,CAAC,IAAIkB,QAAQ,GAAGlB,QAAQ,GAAG,CAAC,EAAE;QAC3D;QACAX,eAAe,CAACW,QAAQ,CAAC,CAACY,OAAO,CAAChC,QAAQ,CAAC,CAAC,CAAC,CAACuC,cAAc,CAAC;UAC3DC,KAAK,EAAE;QACT,CAAC,CAAC;MACJ;IACF;IACA;IACA,IAAIlB,MAAM,IAAI,CAACe,WAAW,CAACL,OAAO,IAAIZ,QAAQ,EAAE;MAC9CX,eAAe,CAACW,QAAQ,CAAC,CAACY,OAAO,CAAChC,QAAQ,CAAC,CAAC,CAAC,CAACyC,KAAK,CAAC;QAAEC,aAAa,EAAG1B,YAAY,CAAC,CAAC,KAAKI;MAAU,CAAC,CAAC;IACvG;IACA,IAAIb,YAAY,CAACyB,OAAO,EAAE;MACxB3B,aAAa,CAACoC,KAAK,CAAC,CAAC;MACrBlC,YAAY,CAACyB,OAAO,GAAG,KAAK;IAC9B;IACAK,WAAW,CAACL,OAAO,GAAGV,MAAM;EAC9B,CAAC,EAAE,CAACA,MAAM,EAAEtB,QAAQ,CAACa,MAAM,EAAEG,YAAY,EAAEP,eAAe,EAAEW,QAAQ,EAAEf,aAAa,CAAC,CAAC;EAErF,oBACEtB,KAAA,CAAA4D,aAAA;IAAK1C,SAAS,EAAEb,UAAU,CAAC,kBAAkB,EAAEa,SAAS,CAAE;IAAA,GAAKG;EAAK,gBAClErB,KAAA,CAAA4D,aAAA,CAACrD,MAAM;IACL,iBAAc,MAAM;IACpB,iBAAegC,MAAO;IACtBsB,GAAG,EAAEtC,gBAAiB;IACtBJ,OAAO,EAAEA,OAAQ;IACjB2C,SAAS,EAAExD,UAAW;IACtByC,OAAO,EAAEP,IAAK;IACdpB,QAAQ,EAAEA;EAAS,GAElBiB,QAAQ,KAAKD,SAAS,IAAInB,QAAQ,CAACoB,QAAQ,CAAC,GAAGpB,QAAQ,CAACoB,QAAQ,CAAC,CAAChB,KAAK,CAACJ,QAAQ,GAAGD,cAC9E,CAAC,eACThB,KAAA,CAAA4D,aAAA;IAAK1C,SAAS,EAAC;EAAwB,gBACrClB,KAAA,CAAA4D,aAAA,CAACpD,UAAU;IACTuD,SAAS,EAAC,cAAc;IACxBC,WAAW,EAAE1C,aAAc;IAC3BiB,MAAM,EAAEA,MAAO;IACf0B,OAAO,EAAExB,KAAM;IACfyB,SAAS,EACP,CACE;MACEC,IAAI,EAAE,MAAM;MACZC,OAAO,EAAE;QACPC,OAAO,EAAE;UAAEC,GAAG,EAAE,GAAG;UAAEC,MAAM,EAAE;QAAI;MACnC;IACF,CAAC;EAEJ,gBAEDvE,KAAA,CAAA4D,aAAA,CAAClD,IAAI;IAAC,cAAW;EAAa,GAC3BgC,eAAe,CAAC,CAAC,CAACX,GAAG,CAAC,CAACa,KAAK,EAAEC,KAAK,kBAClC7C,KAAA,CAAA4D,aAAA;IAAKY,GAAG,EAAE5B,KAAK,CAACvB,KAAK,CAAC6B,EAAG;IAACW,GAAG,EAAEnC,eAAe,CAACmB,KAAK;EAAE,GACnDD,KACE,CACN,CACG,CACI,CACT,CACF,CAAC;AAEV;AAEA9B,UAAU,CAAC2D,SAAS,GAAG;EACrB;EACAzD,cAAc,EAAEZ,SAAS,CAACsE,MAAM;EAChC;EACAzD,QAAQ,EAAEb,SAAS,CAACuE,IAAI,CAACC,UAAU;EACnC;EACA1D,SAAS,EAAEd,SAAS,CAACsE,MAAM;EAC3B;EACAvD,OAAO,EAAEf,SAAS,CAACsE,MAAM;EACzB;EACAtD,QAAQ,EAAEhB,SAAS,CAACyE;AACtB,CAAC;AAED/D,UAAU,CAACgE,YAAY,GAAG;EACxB9D,cAAc,EAAEH,2BAA2B;EAC3CK,SAAS,EAAEkB,SAAS;EACpBjB,OAAO,EAAE,iBAAiB;EAC1BC,QAAQ,EAAE;AACZ,CAAC;AAED,MAAM2D,4BAA4B,GAAGpE,mBAAmB,CAACG,UAAU,EAAE,YAAY,EAAE;EACjFkE,MAAM,EAAE;IACNC,QAAQ,EAAErE,SAAS,CAACsE,gBAAgB;IACpCC,OAAO,EAAE,iDAAiD;IAC1DC,OAAO,EAAE,SAAS;IAClBC,SAAS,EAAEA,CAAA,KAAM;EACnB;AACF,CAAC,CAAC;AAEF,eAAeN,4BAA4B","ignoreList":[]}